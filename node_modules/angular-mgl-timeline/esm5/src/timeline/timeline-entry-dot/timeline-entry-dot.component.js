import { __assign, __decorate, __param } from "tslib";
import { Component, Input, HostBinding, ElementRef, EventEmitter, Output, AfterViewInit, Renderer2, ChangeDetectorRef, Inject, ViewEncapsulation } from '@angular/core';
import { AnimationBuilder, style, animate } from '@angular/animations';
import { DOCUMENT } from '@angular/common';
var MglTimelineEntryDotComponent = /** @class */ (function () {
    function MglTimelineEntryDotComponent(animationBuilder, elementRef, renderer, changeDetectorRef, document) {
        this.animationBuilder = animationBuilder;
        this.elementRef = elementRef;
        this.renderer = renderer;
        this.changeDetectorRef = changeDetectorRef;
        this.document = document;
        this._expanded = false;
        this._alternate = false;
        this._mobile = false;
        this._size = 50;
        this.animationDone = new EventEmitter();
        this.expandAnimationTiming = '200ms ease';
        this.collapseAnimationTiming = '100ms ease';
        this.clazz = 'primary';
    }
    Object.defineProperty(MglTimelineEntryDotComponent.prototype, "size", {
        get: function () {
            return this._size;
        },
        set: function (size) {
            this._size = size;
            this.setStyle();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MglTimelineEntryDotComponent.prototype, "alternate", {
        get: function () {
            return this._alternate;
        },
        set: function (alternate) {
            this._alternate = alternate;
            this.setStyle();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MglTimelineEntryDotComponent.prototype, "mobile", {
        get: function () {
            return this._mobile;
        },
        set: function (mobile) {
            this._mobile = mobile;
            this.setStyle();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MglTimelineEntryDotComponent.prototype, "expanded", {
        get: function () {
            return this._expanded;
        },
        set: function (expanded) {
            var animate = this._expanded !== expanded;
            this._expanded = expanded;
            animate ? this.animate() : this.setStyle();
        },
        enumerable: true,
        configurable: true
    });
    MglTimelineEntryDotComponent.prototype.ngAfterViewInit = function () {
        this.initialStyle = this.document.defaultView.getComputedStyle(this.elementRef.nativeElement);
        this.setStyle();
        this.changeDetectorRef.detectChanges();
    };
    MglTimelineEntryDotComponent.prototype.getCollapsedStyle = function () {
        return {
            top: '50%',
            left: (this.alternate || this.mobile) ? '-5px' : 'calc(100% + 5px)',
            width: this.size + 'px',
            height: this.size + 'px',
            opacity: 1,
            transform: 'translateY(-50%) translateX(-50%)',
            boxShadow: this.initialStyle && this.initialStyle.boxShadow,
            borderRadius: '100px'
        };
    };
    MglTimelineEntryDotComponent.prototype.getTransitionStyle = function () {
        return __assign(__assign({}, this.getCollapsedStyle()), { left: '50%', opacity: 0.5, boxShadow: 'none' });
    };
    MglTimelineEntryDotComponent.prototype.getExpandedStyle = function () {
        return __assign(__assign({}, this.getTransitionStyle()), { left: '0', transform: 'translateX(0) translateY(-50%)', width: '100%', height: '100%', opacity: 1, borderRadius: 0 });
    };
    MglTimelineEntryDotComponent.prototype.animate = function () {
        var _this = this;
        this.destroyAnimation();
        if (this.expanded) {
            this.animation = this.animationBuilder
                .build([
                style(this.getCollapsedStyle()),
                animate(this.expandAnimationTiming, style(this.getTransitionStyle())),
                animate(this.expandAnimationTiming, style(this.getExpandedStyle())),
            ])
                .create(this.elementRef.nativeElement);
            this.animation.onDone(function () { return _this.animationDone.emit({ toState: 'expanded' }); });
            this.animation.play();
        }
        else {
            this.animationBuilder;
            this.animation = this.animationBuilder
                .build([
                style(this.getExpandedStyle()),
                animate(this.collapseAnimationTiming, style(this.getTransitionStyle())),
                animate(this.collapseAnimationTiming, style(this.getCollapsedStyle())),
            ])
                .create(this.elementRef.nativeElement);
            this.animation.onDone(function () { return _this.animationDone.emit({ toState: 'collapsed' }); });
            this.animation.play();
        }
    };
    MglTimelineEntryDotComponent.prototype.setStyle = function () {
        var _this = this;
        this.destroyAnimation();
        var baseStyle = this.expanded ? this.getExpandedStyle() : this.getCollapsedStyle();
        Object.keys(baseStyle).forEach(function (property) {
            _this.renderer.setStyle(_this.elementRef.nativeElement, property, baseStyle[property]);
        });
    };
    MglTimelineEntryDotComponent.prototype.destroyAnimation = function () {
        if (this.animation) {
            this.animation.destroy();
            delete this.animation;
        }
    };
    MglTimelineEntryDotComponent.ctorParameters = function () { return [
        { type: AnimationBuilder },
        { type: ElementRef },
        { type: Renderer2 },
        { type: ChangeDetectorRef },
        { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
    ]; };
    __decorate([
        Input()
    ], MglTimelineEntryDotComponent.prototype, "expandAnimationTiming", void 0);
    __decorate([
        Input()
    ], MglTimelineEntryDotComponent.prototype, "collapseAnimationTiming", void 0);
    __decorate([
        Input('class'),
        HostBinding('class')
    ], MglTimelineEntryDotComponent.prototype, "clazz", void 0);
    __decorate([
        Input()
    ], MglTimelineEntryDotComponent.prototype, "size", null);
    MglTimelineEntryDotComponent = __decorate([
        Component({
            selector: 'mgl-timeline-entry-dot',
            template: "<ng-content></ng-content>\n",
            encapsulation: ViewEncapsulation.None,
            styles: ["mgl-timeline-entry-dot{display:block;position:absolute}"]
        }),
        __param(4, Inject(DOCUMENT))
    ], MglTimelineEntryDotComponent);
    return MglTimelineEntryDotComponent;
}());
export { MglTimelineEntryDotComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZWxpbmUtZW50cnktZG90LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItbWdsLXRpbWVsaW5lLyIsInNvdXJjZXMiOlsic3JjL3RpbWVsaW5lL3RpbWVsaW5lLWVudHJ5LWRvdC90aW1lbGluZS1lbnRyeS1kb3QuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQy9ELGFBQWEsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUN2RSxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQVEzQztJQTRERSxzQ0FBb0IsZ0JBQWtDLEVBQVUsVUFBc0IsRUFDOUUsUUFBbUIsRUFBVSxpQkFBb0MsRUFDL0MsUUFBUTtRQUZkLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQzlFLGFBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxzQkFBaUIsR0FBakIsaUJBQWlCLENBQW1CO1FBQy9DLGFBQVEsR0FBUixRQUFRLENBQUE7UUE1RDFCLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFDM0IsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUM1QixZQUFPLEdBQVksS0FBSyxDQUFDO1FBRXpCLFVBQUssR0FBVyxFQUFFLENBQUM7UUFHM0Isa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBR3hDLDBCQUFxQixHQUFHLFlBQVksQ0FBQztRQUdyQyw0QkFBdUIsR0FBRyxZQUFZLENBQUM7UUFLdkMsVUFBSyxHQUFHLFNBQVMsQ0FBQztJQTBDb0IsQ0FBQztJ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LGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJOztTQUN0QyxDQUFDO1FBK0RDLFdBQUEsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFBO09BOUROLDRCQUE0QixDQWtKeEM7SUFBRCxtQ0FBQztDQUFBLEFBbEpELElBa0pDO1NBbEpZLDRCQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgSW5wdXQsIEhvc3RCaW5kaW5nLCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIE91dHB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCwgUmVuZGVyZXIyLCBDaGFuZ2VEZXRlY3RvclJlZiwgSW5qZWN0LCBWaWV3RW5jYXBzdWxhdGlvblxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFuaW1hdGlvbkJ1aWxkZXIsIHN0eWxlLCBhbmltYXRlIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21nbC10aW1lbGluZS1lbnRyeS1kb3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGltZWxpbmUtZW50cnktZG90LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdGltZWxpbmUtZW50cnktZG90LmNvbXBvbmVudC5zY3NzJ10sXG4gIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmVcbn0pXG5leHBvcnQgY2xhc3MgTWdsVGltZWxpbmVFbnRyeURvdENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQge1xuXG4gIHByaXZhdGUgX2V4cGFuZGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX2FsdGVybmF0ZTogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9tb2JpbGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBpbml0aWFsU3R5bGU7XG4gIHByaXZhdGUgX3NpemU6IG51bWJlciA9IDUwO1xuICBwcml2YXRlIGFuaW1hdGlvbjtcblxuICBhbmltYXRpb25Eb25lID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgQElucHV0KClcbiAgZXhwYW5kQW5pbWF0aW9uVGltaW5nID0gJzIwMG1zIGVhc2UnO1xuXG4gIEBJbnB1dCgpXG4gIGNvbGxhcHNlQW5pbWF0aW9uVGltaW5nID0gJzEwMG1zIGVhc2UnO1xuXG5cbiAgQElucHV0KCdjbGFzcycpXG4gIEBIb3N0QmluZGluZygnY2xhc3MnKVxuICBjbGF6eiA9ICdwcmltYXJ5JztcblxuICBASW5wdXQoKVxuICBzZXQgc2l6ZShzaXplOiBudW1iZXIpIHtcbiAgICB0aGlzLl9zaXplID0gc2l6ZTtcbiAgICB0aGlzLnNldFN0eWxlKCk7XG4gIH1cblxuICBnZXQgc2l6ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fc2l6ZTtcbiAgfVxuXG4gIHNldCBhbHRlcm5hdGUoYWx0ZXJuYXRlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fYWx0ZXJuYXRlID0gYWx0ZXJuYXRlO1xuICAgIHRoaXMuc2V0U3R5bGUoKTtcbiAgfVxuXG4gIGdldCBhbHRlcm5hdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FsdGVybmF0ZTtcbiAgfVxuXG4gIHNldCBtb2JpbGUobW9iaWxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fbW9iaWxlID0gbW9iaWxlO1xuICAgIHRoaXMuc2V0U3R5bGUoKTtcbiAgfVxuXG4gIGdldCBtb2JpbGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX21vYmlsZTtcbiAgfVxuXG4gIHNldCBleHBhbmRlZChleHBhbmRlZDogYm9vbGVhbikge1xuICAgIGNvbnN0IGFuaW1hdGUgPSB0aGlzLl9leHBhbmRlZCAhPT0gZXhwYW5kZWQ7XG4gICAgdGhpcy5fZXhwYW5kZWQgPSBleHBhbmRlZDtcbiAgICBhbmltYXRlID8gdGhpcy5hbmltYXRlKCkgOiB0aGlzLnNldFN0eWxlKClcbiAgfVxuXG4gIGdldCBleHBhbmRlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZXhwYW5kZWQ7XG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGFuaW1hdGlvbkJ1aWxkZXI6IEFuaW1hdGlvbkJ1aWxkZXIsIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLCBwcml2YXRlIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudCkgeyB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuaW5pdGlhbFN0eWxlID0gdGhpcy5kb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICB0aGlzLnNldFN0eWxlKCk7XG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBwcml2YXRlIGdldENvbGxhcHNlZFN0eWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6ICc1MCUnLFxuICAgICAgbGVmdDogKHRoaXMuYWx0ZXJuYXRlIHx8IHRoaXMubW9iaWxlKSA/ICctNXB4JyA6ICdjYWxjKDEwMCUgKyA1cHgpJyxcbiAgICAgIHdpZHRoOiB0aGlzLnNpemUgKyAncHgnLFxuICAgICAgaGVpZ2h0OiB0aGlzLnNpemUgKyAncHgnLFxuICAgICAgb3BhY2l0eTogMSxcbiAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoLTUwJSkgdHJhbnNsYXRlWCgtNTAlKScsXG4gICAgICBib3hTaGFkb3c6IHRoaXMuaW5pdGlhbFN0eWxlICYmIHRoaXMuaW5pdGlhbFN0eWxlLmJveFNoYWRvdyxcbiAgICAgIGJvcmRlclJhZGl1czogJzEwMHB4J1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VHJhbnNpdGlvblN0eWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICAuLi50aGlzLmdldENvbGxhcHNlZFN0eWxlKCksXG4gICAgICBsZWZ0OiAnNTAlJyxcbiAgICAgIG9wYWNpdHk6IDAuNSxcbiAgICAgIGJveFNoYWRvdzogJ25vbmUnXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRFeHBhbmRlZFN0eWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICAuLi50aGlzLmdldFRyYW5zaXRpb25TdHlsZSgpLFxuICAgICAgbGVmdDogJzAnLFxuICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgwKSB0cmFuc2xhdGVZKC01MCUpJyxcbiAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgIG9wYWNpdHk6IDEsXG4gICAgICBib3JkZXJSYWRpdXM6IDBcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFuaW1hdGUoKSB7XG4gICAgdGhpcy5kZXN0cm95QW5pbWF0aW9uKCk7XG4gICAgaWYgKHRoaXMuZXhwYW5kZWQpIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uID0gdGhpcy5hbmltYXRpb25CdWlsZGVyXG4gICAgICAgIC5idWlsZChbXG4gICAgICAgICAgc3R5bGUodGhpcy5nZXRDb2xsYXBzZWRTdHlsZSgpKSxcbiAgICAgICAgICBhbmltYXRlKHRoaXMuZXhwYW5kQW5pbWF0aW9uVGltaW5nLCBzdHlsZSh0aGlzLmdldFRyYW5zaXRpb25TdHlsZSgpKSksXG4gICAgICAgICAgYW5pbWF0ZSh0aGlzLmV4cGFuZEFuaW1hdGlvblRpbWluZywgc3R5bGUodGhpcy5nZXRFeHBhbmRlZFN0eWxlKCkpKSxcbiAgICAgICAgXSlcbiAgICAgICAgLmNyZWF0ZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudClcbiAgICAgIHRoaXMuYW5pbWF0aW9uLm9uRG9uZSgoKSA9PiB0aGlzLmFuaW1hdGlvbkRvbmUuZW1pdCh7IHRvU3RhdGU6ICdleHBhbmRlZCcgfSkpO1xuICAgICAgdGhpcy5hbmltYXRpb24ucGxheSgpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uQnVpbGRlclxuICAgICAgdGhpcy5hbmltYXRpb24gPSB0aGlzLmFuaW1hdGlvbkJ1aWxkZXJcbiAgICAgICAgLmJ1aWxkKFtcbiAgICAgICAgICBzdHlsZSh0aGlzLmdldEV4cGFuZGVkU3R5bGUoKSksXG4gICAgICAgICAgYW5pbWF0ZSh0aGlzLmNvbGxhcHNlQW5pbWF0aW9uVGltaW5nLCBzdHlsZSh0aGlzLmdldFRyYW5zaXRpb25TdHlsZSgpKSksXG4gICAgICAgICAgYW5pbWF0ZSh0aGlzLmNvbGxhcHNlQW5pbWF0aW9uVGltaW5nLCBzdHlsZSh0aGlzLmdldENvbGxhcHNlZFN0eWxlKCkpKSxcbiAgICAgICAgXSlcbiAgICAgICAgLmNyZWF0ZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudClcbiAgICAgIHRoaXMuYW5pbWF0aW9uLm9uRG9uZSgoKSA9PiB0aGlzLmFuaW1hdGlvbkRvbmUuZW1pdCh7IHRvU3RhdGU6ICdjb2xsYXBzZWQnIH0pKTtcbiAgICAgIHRoaXMuYW5pbWF0aW9uLnBsYXkoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFN0eWxlKCkge1xuICAgIHRoaXMuZGVzdHJveUFuaW1hdGlvbigpO1xuICAgIGNvbnN0IGJhc2VTdHlsZSA9IHRoaXMuZXhwYW5kZWQgPyB0aGlzLmdldEV4cGFuZGVkU3R5bGUoKSA6IHRoaXMuZ2V0Q29sbGFwc2VkU3R5bGUoKTtcbiAgICBPYmplY3Qua2V5cyhiYXNlU3R5bGUpLmZvckVhY2gocHJvcGVydHkgPT4ge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgcHJvcGVydHksIGJhc2VTdHlsZVtwcm9wZXJ0eV0pXG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgZGVzdHJveUFuaW1hdGlvbigpIHtcbiAgICBpZiAodGhpcy5hbmltYXRpb24pIHtcbiAgICAgIHRoaXMuYW5pbWF0aW9uLmRlc3Ryb3koKTtcbiAgICAgIGRlbGV0ZSB0aGlzLmFuaW1hdGlvbjtcbiAgICB9XG4gIH1cblxufVxuIl19